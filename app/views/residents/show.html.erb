<% if @profile_img.nil? %>
  <%= image_tag 'profile.jpg' %>
<% else %>
  <%= image_tag(@coordinator.profile_img.url) %>
<% end %>

<div>
    <label>ユーザー名：</label>
    <%= @resident.user_name %>
</div>

<% if resident_signed_in? %>
  <%= link_to 'Edit Profile', edit_resident_path(@resident.id) %><br>
  <%= link_to 'Create Request', new_request_path %>
<% end %>


    <h3>リクエスト一覧</h3>

    <% if @requests.present? %>

    <table>
        <tr>
            <td>リクエストNo.</td>
            <td>ステータス</td>
            <td>クローズ日</td>
            <td>担当コーディネーター</td>
            <td>提案</td>
          <%if resident_signed_in? %>
            <td>チャットルーム</td>
          <% end %>
        </tr>

      <% @requests.each do |request| %>
        <tr>
          <td><%= request.id %></td>
          <td><%= request.status %></td>
          <td><%= request.updated_at %></td>

          <% if request.coordinator_id.present? %>
            <td><%= link_to request.coordinator.name, coordinator_path(request.coordinator.id) %></td>
          <% elsif request.contract.present? && request.contract.approval == false %>
            <td><%= link_to request.contract.coordinator.name, coordinator_path(request.contract.coordinator.id) %>に依頼中</td>
          <% else %>
            <td>コーディネーター募集中</td>
          <% end %>

          <% if resident_signed_in? %>
            <% if request.suggestion.nil? %>
              <td>提案待ち</td>
            <% else %>
              <td><%= link_to '提案詳細へ', suggestion_path(request.suggestion.id) %></td>
            <% end %>

            <% if request.contract.room.nil? %>
              <td><%= link_to 'チャットを開始する', rooms_path(room: {coordinator_id: contract.request.coordinator_id, contract_id: contract.id}), method: :post %></td>
            <% else %>
              <td><%= link_to 'チャットルームへ', room_path(request.contract.room.id) %>
            <% end %>
          <% end %>
         
        </tr>
      <% end %>
    </table>

    <% else %>
      <p>リクエスト履歴がありません。</p>

    <% end %>