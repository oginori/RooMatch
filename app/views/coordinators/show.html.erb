<div>
<% if @profile_img.nil? %>
  <%= image_tag 'profile.jpg' %>
<% else %>
  <%= image_tag(@coordinator.profile_img.url) %>
<% end %>

<h1><%= @coordinator.user_name %></h1>

</div><br>


<% if resident_signed_in? %>
  <% if @request.present? && @contract.nil? %>
    <%= link_to '依頼する', contracts_path(contract: {request_id: @request.id, coordinator_id: @coordinator.id}), method: :post, permitted: true %>

    <% elsif @request.present? && @contract.approval == false && @contract.coordinator_id == @coordinator.id %>
    <%= link_to '依頼を取り消す', contract_path(@request.contract.id), method: :delete, data: { confirm: '本当に依頼を取り消しますか' } %>

    <% elsif @request.present? && @request.coordinator_id == @coordinator.id %>
    <p>取引中</p>

    <% elsif @request.present? && @contract.present? %>
    <p>リクエスト依頼：他のコーディネーターに依頼中です</p>
    
  <% else %>
    <p>リクエスト依頼： リクエストを作成してからの申請となります </p>
    <%= link_to 'リクエストを作成', new_request_path %>
  <% end %>

    

<% elsif current_coordinator.id == @coordinator.id %>
  
  <div>
    <h3>Roomatch案件一覧</h3>

    <% if @contracts.present? %>
      <table>
          <thead>
            <tr>
                <th>リクエストno.</th>
                <th>取引状況</th>
                <th>クローズ日</th>
                <th>取引レジデント</th>
                <th>リクエスト詳細</th>
                <th>チャットルーム</th>
                <th>提案</th>
            </tr>
          </thead>
          <tbody>
            <% @contracts.each do |contract| %>
            <tr>
                <td><%= contract.id %></td>
                <td><%= contract.status %></td>

              <% if contract.status == 'close' %>
                <td><%= contract.updated_at %></td>
              <% elsif contract.status == 'open' %>
                <td>ー</td>
              <% end %>
                
                <td><%= link_to contract.request.resident.user_name, resident_path(contract.request.resident.id) %></td>
                <td><%= link_to '＞＞', request_path(contract.request_id) %></td>

                <% if contract.room.nil? %>
                  <td><%= link_to 'チャットを開始する', rooms_path(room: {resident_id: contract.request.resident_id, contract_id: contract.id}), method: :post %></td>
                <% else %>
                  <td><%= link_to 'チャットルームへ', room_path(contract.room.id) %></td>
                <% end %>

                <% if contract.suggestion.nil? %>
                  <td><%= link_to '提案する', new_suggestion_path %>
                <% else %>
                  <td><%= link_to '提案を見る', suggestion_path(contract.suggestion.id) %>
                <% end %>


            </tr>
            <% end %>
          </tbody>
      </table>
    <% else %>
      <p>取引履歴がありません。<p>
    <% end %>
<% end %>


<h3> <%= @coordinator.user_name %>作成のインテリアコーディネート一覧</h3>

<% @interiors.each do |interior| %>

  <%= image_tag(interior.design_img.url) %><br>
  <div>
      
      <% if current_resident.present? %>
        <% favorite = @favorites.find_by(interior_id: interior.id) %>
        <% if favorite.nil? %>
          <%= link_to '♡', favorites_path(interior_id: interior.id), method: :post %>
        <% else %>
          <%= link_to '❤︎', favorite_path(id: favorite.id), method: :delete %>
        <% end %>
      <% end %>
  </div>
<% end %>
